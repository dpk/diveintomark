<!DOCTYPE HTML>
<html lang=en>
<head>
<meta charset=utf-8>
<title>XML is tough [dive into mark]</title>
<link rel=alternate type=application/atom+xml href=/web/20110806112234/http://diveintomark.org/feed/>
<link rel=me type=text/html href=/web/20110806112234/http://www.google.com/profiles/pilgrim>
<link rel=author href=/web/20110806112234/http://diveintomark.org/about>
<link rel=search type=application/opensearchdescription+xml href=/web/20110806112234/http://wearehugh.com/public/2006/09/opensearch-full.xml title="dive into mark">
<link rel="shortcut icon" href=/web/20110806112234im_/http://diveintomark.org/favicon.ico>
<link rel=prev href="/web/20110806112234/http://diveintomark.org/archives/2004/07/06/nfc" title="Unicode Normalization Form C">
<link rel=next href="/web/20110806112234/http://diveintomark.org/archives/2004/07/16/feed-parser-33" title="Universal Feed Parser 3.3">
<link rel=up href="/web/20110806112234/http://diveintomark.org/archives#p1515" title="July 2004">
<link rel="alternate" type="application/rss+xml" title="dive into mark &raquo; XML is tough Comments Feed" href="/web/20110806112234/http://diveintomark.org/archives/2004/07/06/tough/feed" />
<link rel='index' title='dive into mark' href='/web/20110806112234/http://diveintomark.org/' />
<link rel='prev' title='Unicode Normalization Form C' href='/web/20110806112234/http://diveintomark.org/archives/2004/07/06/nfc' />
<link rel='next' title='Universal Feed Parser 3.3' href='/web/20110806112234/http://diveintomark.org/archives/2004/07/16/feed-parser-33' />
<link rel='canonical' href='/web/20110806112234/http://diveintomark.org/archives/2004/07/06/tough' />
<link rel='shortlink' href='/web/20110806112234/http://diveintomark.org/?p=1515' />
<meta name="description" content="You know what I want for Christmas? Markup Barbie. You pull a string and she says XML is tough.">
<meta name="keywords" content="draconian,markup,xml">
<link href="/web/20110806112234cs_/http://fonts.googleapis.com/css?family=Lora" rel=stylesheet>
<style type=text/css>
/*dive into minimalism(c)2010 Mark Pilgrim,MIT-licensed including graphics*/
html{background:white url(/web/20110806112234/http://wearehugh.com/m.jpg) no-repeat bottom right;color:black}
body{font:normal medium Lora,serif;margin:1.75em auto;width:40em;line-height:1.75;word-spacing:0.1em}
em,i,blockquote{font-family:Lora,serif;font-style:oblique}
strong,b{font-family:Lora,serif;}
pre,code,var,samp,kbd,tt{font-family:monospace}
h2,h3{font-weight:bold}
.c{font-family:'Arial Unicode MS',FreeSerif,'DejaVu Sans',sans-serif}
a{background:transparent;text-decoration:none;border-bottom:1px dotted}
a:hover{border-bottom:1px solid}
a:link{color:#1b67c9}
a:visited{color:darkorchid}
h1 a,h2 a,h3 a,#nav a,.punch a{color:inherit !important}
abbr,.p{border:0;letter-spacing:0.1em;text-transform:lowercase;font-variant:small-caps}
h1,h2,h3,p,ul,ol,#nav{margin:1.75em 0}
h1,h2,h3{font-size:medium}
h1,h2{display:inline}
h1{font-weight:normal}
pre,tt{white-space:pre-wrap;font-size:medium;line-height:2.154}
cite{font-style:normal}
img{border:0}
.framed{border:1px solid}
.cl,#arc th,#arc td,.punch p{list-style:none;margin:0;padding:0}
.cl li{margin-bottom:-1px;border-bottom:1px dotted;overflow:hidden}
.sig,.tb,.pb,blockquote{font-size:small;line-height:2.154;margin:2.154em 0;padding:0}
blockquote{font-style:oblique;border-left:1px dotted;margin-left:2.154em;padding-left:2.154em}
blockquote p{margin:2.154em 0}
.tb,.pb{margin-top:0;padding:2.154em 0}
.sig,.punch,#arc th{text-align:right}
.f,.c{text-align:center;clear:both}
#comment,#arc{width:100%}
#comment{height:14.6em;margin:0;line-height:2.154}
.me{background:papayawhip;color:black;padding:1.75em 1.75em 0 1.75em;border-top:1px dotted;margin-top:-2px}
.me>p:first-child{margin-top:0}
.punch{float:right;font-size:x-small;margin:0 0 1.75em 1.75em;line-height:1.75}
#nav + .punch + p:first-letter{float:left;color:gainsboro;padding:0.11em 4px 0 0;font:normal 4em/0.68 serif}
#arc th{padding:0 1.75em 0 0;vertical-align:baseline}
#arc{border-collapse:collapse}
figure{display:block;text-align:center;margin:1.75em 0}
figure img{display:block;margin:0 auto}
</style>
<script>_gaq=[['_setAccount','UA-7434570-2'],['_trackPageview'],['_trackPageLoadTime']];(function(){var g=document.createElement('script');g.src='//www.google-analytics.com/ga.js';g.setAttribute('async','true');document.documentElement.firstChild.appendChild(g);})();</script>
<link rel=canonical href="/web/20110806112234/http://diveintomark.org/archives/2004/07/06/tough">
</head>
<body>
<!-- BEGIN WAYBACK TOOLBAR INSERT -->

<script type="text/javascript" src="/static/js/disclaim-element.js" ></script>
<script type="text/javascript" src="/static/js/graph-calc.js" ></script>
<script type="text/javascript" src="/static/jflot/jquery.min.js" ></script>
<script type="text/javascript">
//<![CDATA[
var firstDate = 820454400000;
var lastDate = 1388534399999;
var wbPrefix = "/web/";
var wbCurrentUrl = "http:\/\/diveintomark.org\/archives\/2004\/07\/06\/tough";

var curYear = -1;
var curMonth = -1;
var yearCount = 18;
var firstYear = 1996;
var imgWidth = 450;
var yearImgWidth = 25;
var monthImgWidth = 2;
var trackerVal = "none";
var displayDay = "6";
var displayMonth = "Aug";
var displayYear = "2011";
var prettyMonths = ["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];

function showTrackers(val) {
	if(val == trackerVal) {
		return;
	}
	if(val == "inline") {
		document.getElementById("displayYearEl").style.color = "#ec008c";
		document.getElementById("displayMonthEl").style.color = "#ec008c";
		document.getElementById("displayDayEl").style.color = "#ec008c";		
	} else {
		document.getElementById("displayYearEl").innerHTML = displayYear;
		document.getElementById("displayYearEl").style.color = "#ff0";
		document.getElementById("displayMonthEl").innerHTML = displayMonth;
		document.getElementById("displayMonthEl").style.color = "#ff0";
		document.getElementById("displayDayEl").innerHTML = displayDay;
		document.getElementById("displayDayEl").style.color = "#ff0";
	}
   document.getElementById("wbMouseTrackYearImg").style.display = val;
   document.getElementById("wbMouseTrackMonthImg").style.display = val;
   trackerVal = val;
}
function getElementX2(obj) {
	var thing = jQuery(obj);
	if((thing == undefined) 
			|| (typeof thing == "undefined") 
			|| (typeof thing.offset == "undefined")) {
		return getElementX(obj);
	}
	return Math.round(thing.offset().left);
}
function trackMouseMove(event,element) {

   var eventX = getEventX(event);
   var elementX = getElementX2(element);
   var xOff = eventX - elementX;
	if(xOff < 0) {
		xOff = 0;
	} else if(xOff > imgWidth) {
		xOff = imgWidth;
	}
   var monthOff = xOff % yearImgWidth;

   var year = Math.floor(xOff / yearImgWidth);
	var yearStart = year * yearImgWidth;
   var monthOfYear = Math.floor(monthOff / monthImgWidth);
   if(monthOfYear > 11) {
       monthOfYear = 11;
   }
   // 1 extra border pixel at the left edge of the year:
   var month = (year * 12) + monthOfYear;
   var day = 1;
	if(monthOff % 2 == 1) {
		day = 15;
	}
	var dateString = 
		zeroPad(year + firstYear) + 
		zeroPad(monthOfYear+1,2) +
		zeroPad(day,2) + "000000";

	var monthString = prettyMonths[monthOfYear];
	document.getElementById("displayYearEl").innerHTML = year + 1996;
	document.getElementById("displayMonthEl").innerHTML = monthString;
	// looks too jarring when it changes..
	//document.getElementById("displayDayEl").innerHTML = zeroPad(day,2);

	var url = wbPrefix + dateString + '/' +  wbCurrentUrl;
	document.getElementById('wm-graph-anchor').href = url;

   //document.getElementById("wmtbURL").value="evX("+eventX+") elX("+elementX+") xO("+xOff+") y("+year+") m("+month+") monthOff("+monthOff+") DS("+dateString+") Moy("+monthOfYear+") ms("+monthString+")";
   if(curYear != year) {
       var yrOff = year * yearImgWidth;
       document.getElementById("wbMouseTrackYearImg").style.left = yrOff + "px";
       curYear = year;
   }
   if(curMonth != month) {
       var mtOff = year + (month * monthImgWidth) + 1;
       document.getElementById("wbMouseTrackMonthImg").style.left = mtOff + "px";
       curMonth = month;
   }
}
//]]>
</script>

<style type="text/css">body{margin-top:0!important;padding-top:0!important;min-width:800px!important;}#wm-ipp a:hover{text-decoration:underline!important;}</style>
<div id="wm-ipp" style="display:none; position:relative;padding:0 5px;min-height:70px;min-width:800px; z-index:9000;">
<div id="wm-ipp-inside" style="position:fixed;padding:0!important;margin:0!important;width:97%;min-width:780px;border:5px solid #000;border-top:none;background-image:url(/static/images/toolbar/wm_tb_bk_trns.png);text-align:center;-moz-box-shadow:1px 1px 3px #333;-webkit-box-shadow:1px 1px 3px #333;box-shadow:1px 1px 3px #333;font-size:11px!important;font-family:'Lucida Grande','Arial',sans-serif!important;">
   <table style="border-collapse:collapse;margin:0;padding:0;width:100%;"><tbody><tr>
   <td style="padding:10px;vertical-align:top;min-width:110px;">
   <a href="/web/" title="Wayback Machine home page" style="background-color:transparent;border:none;"><img src="/static/images/toolbar/wayback-toolbar-logo.png" alt="Wayback Machine" width="110" height="39" border="0"/></a>
   </td>
   <td style="padding:0!important;text-align:center;vertical-align:top;width:100%;">

       <table style="border-collapse:collapse;margin:0 auto;padding:0;width:570px;"><tbody><tr>
       <td style="padding:3px 0;" colspan="2">
       <form target="_top" method="get" action="/web/form-submit.jsp" name="wmtb" id="wmtb" style="margin:0!important;padding:0!important;"><input type="text" name="url" id="wmtbURL" value="http://diveintomark.org/archives/2004/07/06/tough" style="width:400px;font-size:11px;font-family:'Lucida Grande','Arial',sans-serif;" onfocus="javascript:this.focus();this.select();" /><input type="hidden" name="type" value="replay" /><input type="hidden" name="date" value="20110806112234" /><input type="submit" value="Go" style="font-size:11px;font-family:'Lucida Grande','Arial',sans-serif;margin-left:5px;" /><span id="wm_tb_options" style="display:block;"></span></form>
       </td>
       <td style="vertical-align:bottom;padding:5px 0 0 0!important;" rowspan="2">
           <table style="border-collapse:collapse;width:110px;color:#99a;font-family:'Helvetica','Lucida Grande','Arial',sans-serif;"><tbody>
			
           <!-- NEXT/PREV MONTH NAV AND MONTH INDICATOR -->
           <tr style="width:110px;height:16px;font-size:10px!important;">
           	<td style="padding-right:9px;font-size:11px!important;font-weight:bold;text-transform:uppercase;text-align:right;white-space:nowrap;overflow:visible;" nowrap="nowrap">
               
		                <a href="/web/20110629005520/http://diveintomark.org/archives/2004/07/06/tough" style="text-decoration:none;color:#33f;font-weight:bold;background-color:transparent;border:none;" title="29 Jun 2011"><strong>JUN</strong></a>
		                
               </td>
               <td id="displayMonthEl" style="background:#000;color:#ff0;font-size:11px!important;font-weight:bold;text-transform:uppercase;width:34px;height:15px;padding-top:1px;text-align:center;" title="You are here: 11:22:34 Aug 6, 2011">AUG</td>
				<td style="padding-left:9px;font-size:11px!important;font-weight:bold;text-transform:uppercase;white-space:nowrap;overflow:visible;" nowrap="nowrap">
               
                       Sep
                       
               </td>
           </tr>

           <!-- NEXT/PREV CAPTURE NAV AND DAY OF MONTH INDICATOR -->
           <tr>
               <td style="padding-right:9px;white-space:nowrap;overflow:visible;text-align:right!important;vertical-align:middle!important;" nowrap="nowrap">
               
		                <a href="/web/20110629005520/http://diveintomark.org/archives/2004/07/06/tough" title="0:55:20 Jun 29, 2011" style="background-color:transparent;border:none;"><img src="/static/images/toolbar/wm_tb_prv_on.png" alt="Previous capture" width="14" height="16" border="0" /></a>
		                
               </td>
               <td id="displayDayEl" style="background:#000;color:#ff0;width:34px;height:24px;padding:2px 0 0 0;text-align:center;font-size:24px;font-weight: bold;" title="You are here: 11:22:34 Aug 6, 2011">6</td>
				<td style="padding-left:9px;white-space:nowrap;overflow:visible;text-align:left!important;vertical-align:middle!important;" nowrap="nowrap">
               
                       <img src="/static/images/toolbar/wm_tb_nxt_off.png" alt="Next capture" width="14" height="16" border="0"/>
                       
			    </td>
           </tr>

           <!-- NEXT/PREV YEAR NAV AND YEAR INDICATOR -->
           <tr style="width:110px;height:13px;font-size:9px!important;">
				<td style="padding-right:9px;font-size:11px!important;font-weight: bold;text-align:right;white-space:nowrap;overflow:visible;" nowrap="nowrap">
               
		                <a href="/web/20100620110716/http://diveintomark.org/archives/2004/07/06/tough" style="text-decoration:none;color:#33f;font-weight:bold;background-color:transparent;border:none;" title="20 Jun 2010"><strong>2010</strong></a>
		                
               </td>
               <td id="displayYearEl" style="background:#000;color:#ff0;font-size:11px!important;font-weight: bold;padding-top:1px;width:34px;height:13px;text-align:center;" title="You are here: 11:22:34 Aug 6, 2011">2011</td>
				<td style="padding-left:9px;font-size:11px!important;font-weight: bold;white-space:nowrap;overflow:visible;" nowrap="nowrap">
               
                       2012
                       
				</td>
           </tr>
           </tbody></table>
       </td>

       </tr>
       <tr>
       <td style="vertical-align:middle;padding:0!important;">
           <a href="/web/20110806112234*/http://diveintomark.org/archives/2004/07/06/tough" style="color:#33f;font-size:11px;font-weight:bold;background-color:transparent;border:none;" title="See a list of every capture for this URL"><strong>35 captures</strong></a>
           <div style="margin:0!important;padding:0!important;color:#666;font-size:9px;padding-top:2px!important;white-space:nowrap;" title="Timespan for captures of this URL">12 Apr 06 - 6 Aug 11</div>
       </td>
       <td style="padding:0!important;">
       <a style="position:relative; white-space:nowrap; width:450px;height:27px;" href="" id="wm-graph-anchor">
       <div id="wm-ipp-sparkline" style="position:relative; white-space:nowrap; width:450px;height:27px;background-color:#fff;cursor:pointer;border-right:1px solid #ccc;" title="Explore captures for this URL">
			<img id="sparklineImgId" style="position:absolute; z-index:9012; top:0px; left:0px;"
				onmouseover="showTrackers('inline');" 
				onmouseout="showTrackers('none');"
				onmousemove="trackMouseMove(event,this)"
				alt="sparklines"
				width="450"
				height="27"
				border="0"
				src="/web/jsp/graph.jsp?graphdata=450_27_1996:-1:000000000000_1997:-1:000000000000_1998:-1:000000000000_1999:-1:000000000000_2000:-1:000000000000_2001:-1:000000000000_2002:-1:000000000000_2003:-1:000000000000_2004:-1:000000000000_2005:-1:000000000000_2006:-1:000101111100_2007:-1:610201030101_2008:-1:010111000200_2009:-1:010000000000_2010:-1:000001000111_2011:7:000011010000_2012:-1:000000000000_2013:-1:000000000000"></img>
			<img id="wbMouseTrackYearImg" 
				style="display:none; position:absolute; z-index:9010;"
				width="25" 
				height="27"
				border="0"
				src="/static/images/toolbar/transp-yellow-pixel.png"></img>
			<img id="wbMouseTrackMonthImg"
				style="display:none; position:absolute; z-index:9011; " 
				width="2"
				height="27" 
				border="0"
				src="/static/images/toolbar/transp-red-pixel.png"></img>
       </div>
		</a>

       </td>
       </tr></tbody></table>
   </td>
   <td style="text-align:right;padding:5px;width:65px;font-size:11px!important;">
       <a href="javascript:;" onclick="document.getElementById('wm-ipp').style.display='none';" style="display:block;padding-right:18px;background:url(/static/images/toolbar/wm_tb_close.png) no-repeat 100% 0;color:#33f;font-family:'Lucida Grande','Arial',sans-serif;margin-bottom:23px;background-color:transparent;border:none;" title="Close the toolbar">Close</a>
       <a href="http://faq.web.archive.org/" style="display:block;padding-right:18px;background:url(/static/images/toolbar/wm_tb_help.png) no-repeat 100% 0;color:#33f;font-family:'Lucida Grande','Arial',sans-serif;background-color:transparent;border:none;" title="Get some help using the Wayback Machine">Help</a>
   </td>
   </tr></tbody></table>

</div>
</div>
<script type="text/javascript">
 var wmDisclaimBanner = document.getElementById("wm-ipp");
 if(wmDisclaimBanner != null) {
   disclaimElement(wmDisclaimBanner);
 }
</script>
<!-- END WAYBACK TOOLBAR INSERT -->

<div id=nav><h1><a accesskey=1 href=/web/20110806112234/http://diveintomark.org/>dive into mark</a></h1> &#8227;
<a href="/web/20110806112234/http://diveintomark.org/archives#p1515">July 6, 2004</a> &#8227;
<h2>XML is tough</h2> (<a href="/web/20110806112234/http://diveintomark.org/tag/draconian" rel="tag">draconian</a>, <a href="/web/20110806112234/http://diveintomark.org/tag/markup" rel="tag">markup</a>, <a href="/web/20110806112234/http://diveintomark.org/tag/xml" rel="tag">xml</a>)</div>
<p>Tim Bray is learning Python and <a href="/web/20110806112234/http://tbray.org/ongoing/When/200x/2004/07/06/LastFirst">using my feed parser</a> to parse the feeds at <a href="/web/20110806112234/http://planetsun.org/">Planet Sun</a>.  I am suitably flattered, and I sincerely hope that one of the 57 lines in Tim&#8217;s first Python program checks the <a href="/web/20110806112234/http://feedparser.org/docs/bozo.html">bozo bit</a> so Tim can ignore the 13 Planet Sun feeds which are not well-formed XML.</p>

<p>One is <a href="/web/20110806112234/http://www.geoffarnold.com/index.rdf">served as <code>text/plain</code></a>, which means it can never be well-formed.</p>

<p>Two (<a href="/web/20110806112234/http://blogs.sun.com/roller/rss/hcc">a</a>, <a href="/web/20110806112234/http://blogs.sun.com/roller/rss/rgwk">b</a>) contain invalid XML characters.</p>

<p>Ten (<a href="/web/20110806112234/http://blog.glen-martin.com/rss/default.rss">1</a>, <a href="/web/20110806112234/http://blogs.sun.com/roller/rss/Askar">2</a>, <a href="/web/20110806112234/http://blogs.sun.com/roller/rss/csj">3</a>, <a href="/web/20110806112234/http://blogs.sun.com/roller/rss/Herby">4</a>, <a href="/web/20110806112234/http://blogs.sun.com/roller/rss/nob">5</a>, <a href="/web/20110806112234/http://blogs.sun.com/roller/rss/shilei">6</a>, <a href="/web/20110806112234/http://blogs.sun.com/roller/rss/takka">7</a>, <a href="/web/20110806112234/http://www.chanezon.com/pat/weblog/index.rdf">8</a>, <a href="/web/20110806112234/http://www.gnome.org/~calum/?flav=rss">9</a>, <a href="/web/20110806112234/http://norman.walsh.name/atom/whatsnew.xml">10</a>) are served as <code>text/xml</code> with no <code>charset</code> parameter.  Clients are <a href="/web/20110806112234/http://diveintomark.org/archives/2004/02/13/xml-media-types">required to parse such feeds as <code>us-ascii</code></a>, but the feeds contain non-ASCII characters and are therefore not well-formed XML.</p>

<p>On a positive note, it&#8217;s nice to see that Norman Walsh has an Atom feed (#10 in that list).  Pity it&#8217;s not well-formed.  I&#8217;m sure he&#8217;ll fix that in short order.  He&#8217;s no bozo.</p>

<p>You know what I want for Christmas?  Markup Barbie.  You pull a string and she says &#8220;XML is tough.&#8221;</p>
<p class=c>&#167;

<h3 id=comments>Twenty seven comments here (<a href=/web/20110806112234/http://diveintomark.org/recentcomments>latest comments</a>)</h3>
<ol class=cl>
<li id="comment-6050"><p>ROTFC&amp;GWPM</p>
<p>I have to have Markup Barbie. Off to google for &#8220;hacking talking barbie&#8221;&#8230;</p>
<p class=sig>&#8212;&#8201;<cite><a href='/web/20110806112234/http://philringnalda.com/' rel='external nofollow' class='url'>Phil Ringnalda</a></cite>&#160;<a class=p href="/web/20110806112234/http://diveintomark.org/archives/2004/07/06/tough#comment-6050" title="July 7, 2004 @ 3:05 am"><img alt="#" src=/web/20110806112234im_/http://wearehugh.com/h.png width=8 height=9></a></li>
<li id="comment-6052"><p>IMO, the text/xml content type is one of the most unfortunate things that have happened to XML. Using it instead of application/xml almost warrants raising the bozo bit pre-emptively.</p>
<p class=sig>&#8212;&#8201;<cite><a href='/web/20110806112234/http://iki.fi/hsivonen/' rel='external nofollow' class='url'>Henri Sivonen</a></cite>&#160;<a class=p href="/web/20110806112234/http://diveintomark.org/archives/2004/07/06/tough#comment-6052" title="July 7, 2004 @ 3:24 am"><img alt="#" src=/web/20110806112234im_/http://wearehugh.com/h.png width=8 height=9></a></li>
<li id="comment-6054"><p>For those wondering what the hell Phil&#8217;s unmarked abbreviation means:</p>
<p><a href="/web/20110806112234/http://philringnalda.com/blog/2004/04/meet_the_new_boss.php" rel="nofollow">http://philringnalda.com/blog/2004/04/meet_the_new_boss.php</a></p>
<p class=sig>&#8212;&#8201;<cite><a href='/web/20110806112234/http://photomatt.net/' rel='external nofollow' class='url'>Matt</a></cite>&#160;<a class=p href="/web/20110806112234/http://diveintomark.org/archives/2004/07/06/tough#comment-6054" title="July 7, 2004 @ 3:56 am"><img alt="#" src=/web/20110806112234im_/http://wearehugh.com/h.png width=8 height=9></a></li>
<li id="comment-6055"><p>Sounds like the only bad xml are the two with invalid characters. The rest of the problems have nothing to do with XML or its well-formedness. Transport of the XML is the issue (which is the same problem people have been screwing up since the first heterogeneous network).</p>
<p>XML itself is pretty damn trivial if you use the right tools to generate and parse, rather than think &#8220;I&#8217;ll just use print&#8221;.</p>
<p class=sig>&#8212;&#8201;<cite><a href='/web/20110806112234/http://www.stuartbishop.net/' rel='external nofollow' class='url'>Stuart</a></cite>&#160;<a class=p href="/web/20110806112234/http://diveintomark.org/archives/2004/07/06/tough#comment-6055" title="July 7, 2004 @ 5:18 am"><img alt="#" src=/web/20110806112234im_/http://wearehugh.com/h.png width=8 height=9></a></li>
<li class=me id="comment-6058"><p>> The rest of the problems have nothing to do with XML or its well-formedness.</p>
<p>You must be new here.</p>
<p class=sig>&#8212;&#8201;<cite><a href='/web/20110806112234/http://diveintomark.org/' rel='external nofollow' class='url'>Mark</a></cite>&#160;<a class=p href="/web/20110806112234/http://diveintomark.org/archives/2004/07/06/tough#comment-6058" title="July 7, 2004 @ 8:15 am"><img alt="#" src=/web/20110806112234im_/http://wearehugh.com/h.png width=8 height=9></a></li>
<li class=me id="comment-6059"><p>For reference, <a href="/web/20110806112234/http://www.ietf.org/rfc/rfc3023.txt">RFC 3023</a> and <a href="/web/20110806112234/http://www.imc.org/atom-syntax/mail-archive/msg05575.html">the author of RFC 3023 on the well-formedness of XML served as text/plain</a>.</p>
<p class=sig>&#8212;&#8201;<cite><a href='/web/20110806112234/http://diveintomark.org/' rel='external nofollow' class='url'>Mark</a></cite>&#160;<a class=p href="/web/20110806112234/http://diveintomark.org/archives/2004/07/06/tough#comment-6059" title="July 7, 2004 @ 8:24 am"><img alt="#" src=/web/20110806112234im_/http://wearehugh.com/h.png width=8 height=9></a></li>
<li id="comment-6060"><p>Mark, I think you might have misinterpreted that email judging by what you wrote above.  It states:</p>
<p>&#8220;So, I think that MIME entities labelled as text/plain are not well-formed XML documents.&#8221;</p>
<p>I don&#8217;t think he was drawing a distinction between well-formed and malformed XML documents.  I think he was just saying &#8220;nope, it&#8217;s not XML&#8221;.  If the documents were to be treated as XML, they could indeed be well-formed, it&#8217;s just that proper use of HTTP means that they shouldn&#8217;t be treated as XML.</p>
<p>So, at least in this case, I agree with Stuart, this is an HTTP issue, not an XML issue.  The same applies to anything served via HTTP with the wrong Content-Type header &#8211; &#8220;HTML&#8221; served as text/plain?  Not HTML.  &#8220;JPEG&#8221; served as application/xhtml+xml?  Not JPEG.  And so on.  It&#8217;s not an XML issue.</p>
<p class=sig>&#8212;&#8201;<cite>Jim</cite>&#160;<a class=p href="/web/20110806112234/http://diveintomark.org/archives/2004/07/06/tough#comment-6060" title="July 7, 2004 @ 8:39 am"><img alt="#" src=/web/20110806112234im_/http://wearehugh.com/h.png width=8 height=9></a></li>
<li class=me id="comment-6061"><p>On the atom-syntax mailing list, I asked a specific question: how I should handle XML served as text/plain.  The answer came back quite clearly, and from a source I would treat as authoritative: anything served as text/plain is not a well-formed XML document.  At that point, the provisions of the XML specification kick in and demand immediate rejection.</p>
<p>Well-formedness is more than bytes; it&#8217;s also the transport.  The XML specification itself references RFC 3023 to determine the character encoding of a document served over HTTP.  And it makes no sense to say that an XML document is well-formed &#8220;except for that pesky encoding issue.&#8221;  Determining the character encoding is a prerequisite for parsing, and therefore well-formedness.</p>
<p>We&#8217;ve been grappling with this issue for some time now on atom-syntax.  There&#8217;s no way around RFC 3023, and believe me we&#8217;ve tried.  If you&#8217;ve been downloading XML and throwing it blindly into your XML parser without looking at the Content-type header, *you are doing it wrong*.  There&#8217;s no two ways to look at it.  You&#8217;re just wrong.  Stop doing that.</p>
<p class=sig>&#8212;&#8201;<cite><a href='/web/20110806112234/http://diveintomark.org/' rel='external nofollow' class='url'>Mark</a></cite>&#160;<a class=p href="/web/20110806112234/http://diveintomark.org/archives/2004/07/06/tough#comment-6061" title="July 7, 2004 @ 9:08 am"><img alt="#" src=/web/20110806112234im_/http://wearehugh.com/h.png width=8 height=9></a></li>
<li id="comment-6062"><p>Actually, the problem with <a href="/web/20110806112234/http://blogs.sun.com/roller/rss/rgwk">http://blogs.sun.com/roller/rss/rgwk</a> isn&#8217;t that it contains illegal characters &#8211; it doesn&#8217;t.</p>
<p>The problem is that the document appears chopped off in the middle &#8211; the last line is:</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&lt;guid isPermaLink=&#8221;true&#8221;&gt;<a href="/web/20110806112234/http://blogs.sun.com/roller" rel="nofollow">http://blogs.sun.com/roller</a></p>
<p class=sig>&#8212;&#8201;<cite><a href='/web/20110806112234/http://www.snowplow.org/martin' rel='external nofollow' class='url'>Daniel Martin</a></cite>&#160;<a class=p href="/web/20110806112234/http://diveintomark.org/archives/2004/07/06/tough#comment-6062" title="July 7, 2004 @ 9:46 am"><img alt="#" src=/web/20110806112234im_/http://wearehugh.com/h.png width=8 height=9></a></li>
<li class=me id="comment-6063"><p>I stand corrected.  I had assumed that that was just the parser&#8217;s way of telling me there was an invalid character, and refusing to show me any further characters.</p>
<p class=sig>&#8212;&#8201;<cite><a href='/web/20110806112234/http://diveintomark.org/' rel='external nofollow' class='url'>Mark</a></cite>&#160;<a class=p href="/web/20110806112234/http://diveintomark.org/archives/2004/07/06/tough#comment-6063" title="July 7, 2004 @ 11:29 am"><img alt="#" src=/web/20110806112234im_/http://wearehugh.com/h.png width=8 height=9></a></li>
<li id="comment-6064"><p>> The answer came back quite clearly, and from a source I would treat as authoritative: anything served as text/plain is not a well-formed XML document.</p>
<p>So say that instead of &#8220;which means it can never be well-formed.&#8221;  Once more, the issue is that it isn&#8217;t an XML document, not that there&#8217;s a well-formedness error.</p>
<p>> At that point, the provisions of the XML specification kick in and demand immediate rejection.</p>
<p>No, the rejection happens before then.  The XML specification doesn&#8217;t even apply.  From <a href="/web/20110806112234/http://www.w3.org/Protocols/rfc2616/rfc2616-sec7.html#sec7.2.1">RFC 2616, section 7.2.1</a>:</p>
<p>&#8220;If and only if the media type is not given by a Content-Type field, the recipient MAY attempt to guess the media type via inspection of its content and/or the name extension(s) of the URI used to identify the resource.&#8221;</p>
<p>The resource should be rejected before it is even parsed.  It isn&#8217;t XML of any kind, well-formed, malformed, anything.  It is plain text.  The HTTP specification says so clearly.  I&#8217;ll take the unambiguous word of a specification over an ambiguous statement by a specification author any day.</p>
<p>As for the character encoding issue, I never argued against your point there.  I&#8217;m arguing solely that &#8220;Content-Type: text/plain&#8221; is an HTTP complication and not an XML complication.</p>
<p>> If you’ve been downloading XML and throwing it blindly into your XML parser without looking at the Content-type header, *you are doing it wrong*. There’s no two ways to look at it. You’re just wrong. Stop doing that.</p>
<p>I&#8217;m arguing that it&#8217;s an HTTP requirement, not that the requirement doesn&#8217;t exist.</p>
<p class=sig>&#8212;&#8201;<cite>Jim</cite>&#160;<a class=p href="/web/20110806112234/http://diveintomark.org/archives/2004/07/06/tough#comment-6064" title="July 7, 2004 @ 12:01 pm"><img alt="#" src=/web/20110806112234im_/http://wearehugh.com/h.png width=8 height=9></a></li>
<li class=me id="comment-6065"><p>Jim, I think we&#8217;re saying the same thing.  A document served as &#8220;text/plain&#8221; can never be considered well-formed XML, because it must never be treated as XML in the first place.  If you get as far as handing it to your XML parser to determine its well-formedness, you have already made an error.</p>
<p class=sig>&#8212;&#8201;<cite><a href='/web/20110806112234/http://diveintomark.org/' rel='external nofollow' class='url'>Mark</a></cite>&#160;<a class=p href="/web/20110806112234/http://diveintomark.org/archives/2004/07/06/tough#comment-6065" title="July 7, 2004 @ 3:48 pm"><img alt="#" src=/web/20110806112234im_/http://wearehugh.com/h.png width=8 height=9></a></li>
<li id="comment-6066"><p>I agree with that, I just take exception to you holding it up as evidence that &#8220;XML is tough&#8221; :)</p>
<p class=sig>&#8212;&#8201;<cite>Jim</cite>&#160;<a class=p href="/web/20110806112234/http://diveintomark.org/archives/2004/07/06/tough#comment-6066" title="July 7, 2004 @ 5:47 pm"><img alt="#" src=/web/20110806112234im_/http://wearehugh.com/h.png width=8 height=9></a></li>
<li id="comment-6067"><p>HTTP is tough :/</p>
<p class=sig>&#8212;&#8201;<cite><a href='/web/20110806112234/http://franklinmint.fm/' rel='external nofollow' class='url'>Robert Sayre</a></cite>&#160;<a class=p href="/web/20110806112234/http://diveintomark.org/archives/2004/07/06/tough#comment-6067" title="July 7, 2004 @ 6:17 pm"><img alt="#" src=/web/20110806112234im_/http://wearehugh.com/h.png width=8 height=9></a></li>
<li id="comment-6068"><p>What if you save the text/xml document to a file, and then read that file into an XML parser? Does it then magically become well-formed, because different rules apply?</p>
<p class=sig>&#8212;&#8201;<cite><a href='/web/20110806112234/http://fishbowl.pastiche.org/' rel='external nofollow' class='url'>Charles Miller</a></cite>&#160;<a class=p href="/web/20110806112234/http://diveintomark.org/archives/2004/07/06/tough#comment-6068" title="July 7, 2004 @ 10:18 pm"><img alt="#" src=/web/20110806112234im_/http://wearehugh.com/h.png width=8 height=9></a></li>
<li class=me id="comment-6069"><p>I believe the program doing the downloading is expected to mungle the XML declaration before saving locally, but I could be totally making that up.  I would certainly expect that.  Consider the case of a charset parameter given in the Content-type HTTP header.  Without munging the XML declaration, that information would be lost.</p>
<p>Vaguely related, or perhaps not, but I just thought of it: when IE 6 retrieves a resource (like a JPEG) served as &#8220;image/jpeg&#8221;, it will change the file extension to &#8220;.jpg&#8221; before saving it in the local cache.  This is to prevent malicious servers from serving files with executable file extensions (like &#8220;.exe&#8221;) as innocuous media types (like &#8220;image/jpeg&#8221;) in order to get executables on the file system for later abuse.</p>
<p>In general, it is up to the caching application to preserve the fidelity of the original file.  The original media type and character encoding information is a big part of that (especially in the case of XML), so I would expect programs to preserve it within the file itself when saving locally.</p>
<p class=sig>&#8212;&#8201;<cite><a href='/web/20110806112234/http://diveintomark.org/' rel='external nofollow' class='url'>Mark</a></cite>&#160;<a class=p href="/web/20110806112234/http://diveintomark.org/archives/2004/07/06/tough#comment-6069" title="July 7, 2004 @ 10:38 pm"><img alt="#" src=/web/20110806112234im_/http://wearehugh.com/h.png width=8 height=9></a></li>
<li id="comment-6070"><p>I really don&#8217;t understand why or how anyone can think XML is so tough. It&#8217;s hands down easier than HTML for me, and much less of a headache. Always has been.</p>
<p class=sig>&#8212;&#8201;<cite><a href='/web/20110806112234/http://www.talldarkanddevon.com/' rel='external nofollow' class='url'>Devon</a></cite>&#160;<a class=p href="/web/20110806112234/http://diveintomark.org/archives/2004/07/06/tough#comment-6070" title="July 7, 2004 @ 10:47 pm"><img alt="#" src=/web/20110806112234im_/http://wearehugh.com/h.png width=8 height=9></a></li>
<li id="comment-6073"><p>According to RFC 3023, &#8220;Unless the charset is UTF-8 or UTF-16, the recipient SHOULD also persistently store information about the charset, perhaps by embedding a correct XML encoding declaration within the XML MIME entity.&#8221; I haven&#8217;t been able to find an HTTP UA which actually does, yet, in the simple case of text/xml without a charset in the Content-type header, but they SHOULD.</p>
<p class=sig>&#8212;&#8201;<cite><a href='/web/20110806112234/http://philringnalda.com/' rel='external nofollow' class='url'>Phil Ringnalda</a></cite>&#160;<a class=p href="/web/20110806112234/http://diveintomark.org/archives/2004/07/06/tough#comment-6073" title="July 8, 2004 @ 12:32 am"><img alt="#" src=/web/20110806112234im_/http://wearehugh.com/h.png width=8 height=9></a></li>
<li id="comment-6074"><p>> What if you save the text/xml document to a file, and then read that file into an XML parser? Does it then magically become well-formed, because different rules apply?</p>
<p>When you are loading a resource from an HTTP source, HTTP rules apply when deciding whether to treat it as XML or not.  If the Content-Type header is present, this should be the deciding factor.</p>
<p>When you are loading a resource from disk, normal OS rules apply when deciding whether to treat it as XML or not.  In many operating systems, the filename extension is the deciding factor.  This isn&#8217;t standardised behaviour though, for instance, with a filesystem like Reiser4, the Content-Type for files downloaded through HTTP could be saved as metadata.</p>
<p>Whether your HTTP client automatically saves filenames with the correct extension or otherwise preserves Content-Type information, and whether it allows you to override it is an implementation issue and is not standardised.</p>
<p>> I haven’t been able to find an HTTP UA which actually does, yet, in the simple case of text/xml without a charset in the Content-type header, but they SHOULD.</p>
<p>Please remember that not all HTTP UAs are XML UAs.  It would be a nightmare if every HTTP UA had to implement every media type RFC.</p>
<p class=sig>&#8212;&#8201;<cite>Jim</cite>&#160;<a class=p href="/web/20110806112234/http://diveintomark.org/archives/2004/07/06/tough#comment-6074" title="July 8, 2004 @ 7:44 am"><img alt="#" src=/web/20110806112234im_/http://wearehugh.com/h.png width=8 height=9></a></li>
<li id="comment-6075"><p>Mark:<br />
>In general, it is up to the caching application to preserve the fidelity of the original file. The original media type and character encoding information is a big part of that (especially in the case of XML), so I would expect programs to preserve it within the file itself when saving locally.</p>
<p>Jim:<br />
>Please remember that not all HTTP UAs are XML UAs. It would be a nightmare if every HTTP UA had to implement every media type RFC.</p>
<p>&#8211;<br />
There&#8217;s the rub, no?  XML requires data inside the envelope, but not all UAs know that data in the envelope should be updated.</p>
<p class=sig>&#8212;&#8201;<cite>Jeremy Dunck</cite>&#160;<a class=p href="/web/20110806112234/http://diveintomark.org/archives/2004/07/06/tough#comment-6075" title="July 8, 2004 @ 1:21 pm"><img alt="#" src=/web/20110806112234im_/http://wearehugh.com/h.png width=8 height=9></a></li>
<li id="comment-6077"><p>In the meantime try this Barbie: <a href="/web/20110806112234/http://www.gophergas.com/funstuff/t-barbie.htm" rel="nofollow">http://www.gophergas.com/funstuff/t-barbie.htm</a></p>
<p class=sig>&#8212;&#8201;<cite>Jens</cite>&#160;<a class=p href="/web/20110806112234/http://diveintomark.org/archives/2004/07/06/tough#comment-6077" title="July 8, 2004 @ 11:21 pm"><img alt="#" src=/web/20110806112234im_/http://wearehugh.com/h.png width=8 height=9></a></li>
<li id="comment-6078"><p>I want a t-shirt with this saying:<br />
&#8220;You obviously mistaken me for someone who understands XML.&#8221;</p>
<p class=sig>&#8212;&#8201;<cite><a href='/web/20110806112234/http://jcwinnie.biz/wordpress/' rel='external nofollow' class='url'>jcwinnie</a></cite>&#160;<a class=p href="/web/20110806112234/http://diveintomark.org/archives/2004/07/06/tough#comment-6078" title="July 9, 2004 @ 7:48 am"><img alt="#" src=/web/20110806112234im_/http://wearehugh.com/h.png width=8 height=9></a></li>
<li id="comment-6081"><p>Some of us continue to believe that the condition where a bag of bits which is intended to be an XML document isn&#8217;t because it has fractured syntax can usefully be distinguished from the condition where a bag of bits which in fact is an XML document is delivered with incorrect headers.  In particular since the second case is distressingly common and in at least some cases apparently can&#8217;t be fixed by the person providing said bag of bits.</p>
<p class=sig>&#8212;&#8201;<cite><a href='/web/20110806112234/http://www.tbray.org/ongoing/' rel='external nofollow' class='url'>Tim Bray</a></cite>&#160;<a class=p href="/web/20110806112234/http://diveintomark.org/archives/2004/07/06/tough#comment-6081" title="July 9, 2004 @ 10:43 pm"><img alt="#" src=/web/20110806112234im_/http://wearehugh.com/h.png width=8 height=9></a></li>
<li class=me id="comment-6082"><p>> can usefully be distinguished from the condition where a bag of bits which in fact is an XML document is delivered with incorrect headers</p>
<p>I agree that the situations can be distinguished; the second case, in additional to being non-well-formed XML, presents a security risk and goes against the TAG finding on authoritative metadata:</p>
<p><a href="/web/20110806112234/http://www.w3.org/2001/tag/doc/mime-respect.html#override-risks" rel="nofollow">http://www.w3.org/2001/tag/doc/mime-respect.html#override-risks</a></p>
<p>&#8220;A user agent that does not respect protocol specifications can violate user privacy, produce security holes, and otherwise create confusion. For example, a user agent can create a security problem by ignoring a &#8220;Content-Type&#8221; header with value text/plain&#8221;</p>
<p>The &#8220;classic&#8221; example of such a security risk is misinterpreting a plain text document as a shell script, but misinterpreting it as a feed is just as dangerous, since feeds can contain embedded or inline (X)HTML markup, which can in turn contain dangerous script.</p>
<p>- <a href="/web/20110806112234/http://diveintomark.org/archives/2003/06/12/how_to_consume_rss_safely">How to consume RSS safely</a></p>
<p>- <a href="/web/20110806112234/http://feedparser.org/docs/html-sanitization.html#advanced.sanitization.why">Why sanitize</a></p>
<p>- <a href="/web/20110806112234/http://feedparser.org/tests/wellformed/sanitize/">Sanitize unit tests</a></p>
<p>UFP 3.3 will flag text/plain feeds as bozo=1, bozo_exception=NonXMLContentType.  You are free to ignore such errors, but you are disrespecting multiple MIME, HTTP, and XML RFCs, as well as a TAG finding.</p>
<p class=sig>&#8212;&#8201;<cite><a href='/web/20110806112234/http://diveintomark.org/' rel='external nofollow' class='url'>Mark</a></cite>&#160;<a class=p href="/web/20110806112234/http://diveintomark.org/archives/2004/07/06/tough#comment-6082" title="July 10, 2004 @ 9:03 am"><img alt="#" src=/web/20110806112234im_/http://wearehugh.com/h.png width=8 height=9></a></li>
<li id="comment-6084"><p>hehe&#8230;.&#8217;hacking vocabulary barbie&#8217; or better yet&#8230;.&#8217;L33t Speak barbie&#8217; with phrases like &#8220;1 w1ll pwn j00r b0x h4w!&#8217; batteries not included!</p>
<p class=sig>&#8212;&#8201;<cite>ITIL Consultant</cite>&#160;<a class=p href="/web/20110806112234/http://diveintomark.org/archives/2004/07/06/tough#comment-6084" title="July 12, 2004 @ 8:52 am"><img alt="#" src=/web/20110806112234im_/http://wearehugh.com/h.png width=8 height=9></a></li>
<li id="comment-6085"><p>Could someone point me toward some information on how to take user input and make sure it is in some particular charset? Perferably a PHP example? I&#8217;m dealing with users who write entries in Word and WordPerfect, on Macs or PCs, then copy and paste the text to their web browsers, then input that, and then I have to take the input and make valid XML. But I can&#8217;t know the charset of the input ahead of time.</p>
<p class=sig>&#8212;&#8201;<cite><a href='/web/20110806112234/http://www.publicdomainsoftware.org/' rel='external nofollow' class='url'>Lawrence Krubner</a></cite>&#160;<a class=p href="/web/20110806112234/http://diveintomark.org/archives/2004/07/06/tough#comment-6085" title="July 12, 2004 @ 11:29 am"><img alt="#" src=/web/20110806112234im_/http://wearehugh.com/h.png width=8 height=9></a></li>
<li id="comment-6086"><p>> Could someone point me toward some information on how to take user input and make sure it is in some particular charset? Perferably a PHP example?</p>
<p>This <a href="/web/20110806112234/http://iki.fi/hsivonen/php-utf8/">UTF-8 to code point array converter</a> can be used for checking if the input is UTF-8 (without any optional PHP extensions).</p>
<p>Recognizing other encodings is hard and requires statistical methods that analyze the spectrum of scalar byte values and guess a plausible encoding.</p>
<p>> I’m dealing with users who write entries in Word and WordPerfect, on Macs or PCs, then copy and paste the text to their web browsers, then input that, and then I have to take the input and make valid XML. But I can’t know the charset of the input ahead of time.</p>
<p>If you serve the form HTML as UTF-8, contemporary browsers submit UTF-8 back.</p>
<p class=sig>&#8212;&#8201;<cite><a href='/web/20110806112234/http://iki.fi/hsivonen/' rel='external nofollow' class='url'>Henri Sivonen</a></cite>&#160;<a class=p href="/web/20110806112234/http://diveintomark.org/archives/2004/07/06/tough#comment-6086" title="July 12, 2004 @ 2:43 pm"><img alt="#" src=/web/20110806112234im_/http://wearehugh.com/h.png width=8 height=9></a></li>
</ol>
<h3 id=respond>Respond privately</h3>
<p><i>I am no longer accepting public comments on this post, but you can use this form to contact me privately.  (Your message will not be published.)</i></p>
<form action="/web/20110806112234/http://wearehugh.com/public/contact.cgi" method=POST id=commentform>
<p><label for=author>Name </label><br>
<input type=text name=author id=author>
<p><label for=email>Email</label><br>
<input type=text name=email id=email></p>
<p><label for=comment>Message</label>
<textarea name=comment id=comment rows=10 cols=40></textarea></p>
<p><input type=submit value="Send message">
</p>
</form>
<p class=c>&#167;
<div class=f>
<p>
<a title="my comments here and elsewhere" href=/web/20110806112234/http://firehose.diveintomark.org/>firehose</a> &#x2027;
<a title="my current open source projects" href="/web/20110806112234/http://code.google.com/u/@UxdWQ1xUDhhBWwd%2F/">code</a> &#x2027;
<a title="my personal news aggregator" href=/web/20110806112234/http://feeds.diveintomark.org/>planet</a>
<p>&#169; 2001&#8211;present <a accesskey=9 href=/web/20110806112234/http://diveintomark.org/about>Mark Pilgrim</a>
</div>
</body>
</html>

<!-- Dynamic page generated in 0.759 seconds. -->
<!-- Cached page generated by WP-Super-Cache on 2011-06-14 00:15:15 -->
<!-- super cache -->




<!--
     FILE ARCHIVED ON 11:22:34 Aug 6, 2011 AND RETRIEVED FROM THE
     INTERNET ARCHIVE ON 21:10:44 Jan 16, 2013.
     JAVASCRIPT APPENDED BY WAYBACK MACHINE, COPYRIGHT INTERNET ARCHIVE.

     ALL OTHER CONTENT MAY ALSO BE PROTECTED BY COPYRIGHT (17 U.S.C.
     SECTION 108(a)(3)).
-->
